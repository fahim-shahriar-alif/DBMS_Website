<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stock Management Dashboard - ASA Data Server</title>
  <link rel="stylesheet" href="css/dashboard.css">
  <link rel="stylesheet" href="css/table.css">
  <style>
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 25px;
      border-radius: 10px;
      color: white;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .stat-card.blue {
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    }

    .stat-card.green {
      background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
    }

    .stat-card.orange {
      background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
    }

    .stat-card h3 {
      margin: 0 0 10px 0;
      font-size: 14px;
      opacity: 0.9;
    }

    .stat-card .value {
      font-size: 32px;
      font-weight: bold;
      margin: 10px 0;
    }

    .stat-card .change {
      font-size: 12px;
      opacity: 0.8;
    }

    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .action-card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      border: 2px solid #e0e0e0;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
    }

    .action-card:hover {
      border-color: #3498db;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .action-card .icon {
      font-size: 32px;
      margin-bottom: 10px;
    }

    .action-card h4 {
      margin: 0;
      color: #2c3e50;
    }

    .recent-activity {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .activity-item {
      padding: 15px;
      border-bottom: 1px solid #ecf0f1;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-icon {
      font-size: 24px;
      margin-right: 15px;
    }

    .activity-details {
      flex: 1;
    }

    .activity-time {
      color: #7f8c8d;
      font-size: 12px;
    }
  </style>
</head>

<body>
  <nav class="navbar">
    <div class="nav-brand">
      <h2>ğŸ›ï¸ ASA Stock Management Portal</h2>
      <p style="font-size: 12px; margin: 0; color: #ddd;" id="stockTeamName">Stock Management Team</p>
    </div>
    <ul class="nav-menu">
      <li><a href="stock-team-dashboard.html" class="active">ğŸ“Š Dashboard</a></li>
      <li><a href="stocks-functional.html">ğŸ“ˆ Stocks</a></li>
      <li><a href="price-history-functional.html">ğŸ“Š Price History</a></li>
      <li><a href="companies-functional.html">ğŸ¢ Companies</a></li>
      <li><a href="transactions-functional.html">ğŸ’° Transactions</a></li>
      <li><a href="trades-functional.html">ğŸ”„ Trades</a></li>
      <li><a href="investors-functional.html">ğŸ‘¤ Investors</a></li>
      <li><a href="#" class="logout" onclick="handleLogout()">ğŸšª Logout</a></li>
    </ul>
  </nav>

  <div class="main-content">
    <div class="welcome-section">
      <h1>Welcome back, <span id="welcomeName">Stock Management Team</span>!</h1>
      <p>Stock & Company Management Portal</p>
    </div>

    <div class="stats-grid">
      <div class="stat-card blue">
        <h3>ğŸ“ˆ Total Stocks</h3>
        <div class="value" id="totalStocks">0</div>
        <div class="change">Active stocks in system</div>
      </div>

      <div class="stat-card green">
        <h3>ğŸ¢ Companies</h3>
        <div class="value" id="totalCompanies">0</div>
        <div class="change">Listed companies</div>
      </div>

      <div class="stat-card orange">
        <h3>ğŸ“Š Price Updates</h3>
        <div class="value" id="priceUpdates">0</div>
        <div class="change">Today's updates</div>
      </div>

      <div class="stat-card">
        <h3>ğŸ’° Avg Stock Price</h3>
        <div class="value" id="avgPrice">$0</div>
        <div class="change">Current average</div>
      </div>
    </div>

    <div class="quick-actions">
      <div class="action-card" onclick="window.location.href='stocks-functional.html'">
        <div class="icon">ğŸ“ˆ</div>
        <h4>Manage Stocks</h4>
        <p style="font-size: 12px; color: #7f8c8d; margin: 5px 0 0 0;">Add, edit, or remove stocks</p>
      </div>

      <div class="action-card" onclick="window.location.href='price-history-functional.html'">
        <div class="icon">ğŸ“Š</div>
        <h4>Update Prices</h4>
        <p style="font-size: 12px; color: #7f8c8d; margin: 5px 0 0 0;">Record price changes</p>
      </div>

      <div class="action-card" onclick="window.location.href='companies-functional.html'">
        <div class="icon">ğŸ¢</div>
        <h4>Manage Companies</h4>
        <p style="font-size: 12px; color: #7f8c8d; margin: 5px 0 0 0;">Update company information</p>
      </div>

      <div class="action-card" onclick="window.location.href='transactions-functional.html'">
        <div class="icon">ğŸ’°</div>
        <h4>View Transactions</h4>
        <p style="font-size: 12px; color: #7f8c8d; margin: 5px 0 0 0;">Monitor trading activity</p>
      </div>
    </div>

    <div class="recent-activity">
      <h2 style="margin-top: 0;">ğŸ“‹ Recent Activity</h2>
      <div id="activityList">
        <div class="activity-item">
          <span class="activity-icon">ğŸ“ˆ</span>
          <div class="activity-details">
            <strong>Stock Added</strong>
            <p style="margin: 5px 0 0 0; font-size: 14px; color: #7f8c8d;">New stock listing created</p>
          </div>
          <div class="activity-time">2 hours ago</div>
        </div>
        <div class="activity-item">
          <span class="activity-icon">ğŸ“Š</span>
          <div class="activity-details">
            <strong>Price Updated</strong>
            <p style="margin: 5px 0 0 0; font-size: 14px; color: #7f8c8d;">Stock prices synchronized</p>
          </div>
          <div class="activity-time">5 hours ago</div>
        </div>
        <div class="activity-item">
          <span class="activity-icon">ğŸ¢</span>
          <div class="activity-details">
            <strong>Company Updated</strong>
            <p style="margin: 5px 0 0 0; font-size: 14px; color: #7f8c8d;">Company information modified</p>
          </div>
          <div class="activity-time">1 day ago</div>
        </div>
      </div>
    </div>
  </div>

  <script src="js/local-database.js"></script>
  <script>
    // Check if stock team is logged in
    const userRole = sessionStorage.getItem('userRole');
    const stockTeamName = sessionStorage.getItem('userFullName') || 'Stock Management Team';
    const isLoggedIn = sessionStorage.getItem('isLoggedIn');

    if (!isLoggedIn || userRole !== 'stock-team') {
      window.location.href = 'login.html';
    }

    // Display stock team name
    document.getElementById('stockTeamName').textContent = stockTeamName;
    document.getElementById('welcomeName').textContent = stockTeamName;

    // Load stock team data
    const stocksDb = new LocalDatabase('stocks');
    const companiesDb = new LocalDatabase('companies');
    const priceHistoryDb = new LocalDatabase('price_history');

    function loadDashboardData() {
      const stocks = stocksDb.getAll();
      const companies = companiesDb.getAll();
      const priceHistory = priceHistoryDb.getAll();

      // Update stats
      document.getElementById('totalStocks').textContent = stocks.length;
      document.getElementById('totalCompanies').textContent = companies.length;

      // Count today's price updates
      const today = new Date().toISOString().split('T')[0];
      const todayUpdates = priceHistory.filter(ph => {
        const phDate = new Date(ph.date).toISOString().split('T')[0];
        return phDate === today;
      }).length;
      document.getElementById('priceUpdates').textContent = todayUpdates;

      // Calculate average stock price
      if (stocks.length > 0) {
        const avgPrice = stocks.reduce((sum, stock) => sum + parseFloat(stock.current_price || 0), 0) / stocks.length;
        document.getElementById('avgPrice').textContent = '$' + avgPrice.toFixed(2);
      }
    }

    function handleLogout() {
      sessionStorage.clear();
      window.location.href = 'login.html';
    }

    // Load data on page load
    loadDashboardData();
  </script>
</body>

</html>